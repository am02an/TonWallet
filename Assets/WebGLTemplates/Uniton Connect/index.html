<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>TonWallet</title>

    <link rel="shortcut icon" href="TemplateData/favicon.ico" />
    <link rel="stylesheet" href="TemplateData/style.css" />
    <link rel="manifest" href="manifest.webmanifest" />

    <!-- ✅ Telegram Mini App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- ✅ TON Wallet SDKs -->
    <script src="https://unpkg.com/@tonconnect/ui@2.0.9/dist/tonconnect-ui.min.js"></script>
    <script src="https://unpkg.com/tonweb@0.0.66/dist/tonweb.js"></script>

    <!-- ✅ Styles -->
    <style>
      body {
        margin: 0;
        background-color: #000;
      }

      #unity-container {
        width: 100vw;
        height: 100vh;
        background-image: url("TemplateData/Background.png");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #unity-canvas {
        background: transparent;
      }

      #custom-loader {
        position: absolute;
        bottom: 10%;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
        width: 300px;
        height: 40px;
        position: absolute;
      }

      #progress-bar-container {
        position: relative;
        width: 100%;
        height: 100%;
        background-image: url("TemplateData/base.png");
        background-size: 100% 100%;
        background-repeat: no-repeat;
      }

      #progress-bar-fill {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        width: 0%;
        background-image: url("TemplateData/Rectangle 9.png");
        background-size: 100% 100%;
        background-repeat: no-repeat;
        transition: width 0.3s ease;
        z-index: 2;
      }
    </style>

    <!-- ✅ Telegram Init -->
    <script>
      window.addEventListener("DOMContentLoaded", function () {
        if (window.Telegram && Telegram.WebApp) {
          Telegram.WebApp.ready();
          Telegram.WebApp.expand();

          const tg = Telegram.WebApp;
          const version = tg.version;

          if (parseFloat(version) >= 7.7) {
            tg.disableScrolling?.();
            tg.disableSwipeBack?.();
            tg.disableClosingConfirmation?.();
          }

          console.log("✅ Telegram Mini App Ready");
          console.log("User Info:", tg.initDataUnsafe?.user);
        }
      });
    </script>
  </head>

  <body>
    <div id="unity-container">
      <canvas id="unity-canvas" width="960" height="600" tabindex="-1"></canvas>

      <!-- Custom Loader -->
      <div id="custom-loader">
        <div id="progress-bar-container">
          <div id="progress-bar-fill"></div>
        </div>
      </div>
    </div>

    <!-- ✅ Unity + Progress logic -->
    <script src="%UNITY_WEBGL_LOADER_URL%"></script>
    <script>
      createUnityInstance(
        document.querySelector("#unity-canvas"),
        {
          dataUrl: "%UNITY_WEBGL_BUILD_URL%.data",
          frameworkUrl: "%UNITY_WEBGL_BUILD_URL%.framework.js",
          codeUrl: "%UNITY_WEBGL_BUILD_URL%.wasm",
          streamingAssetsUrl: "StreamingAssets",
          companyName: "%COMPANY_NAME%",
          productName: "%PRODUCT_NAME%",
          productVersion: "%PRODUCT_VERSION%",
        },
        (progress) => {
          const fill = document.getElementById("progress-bar-fill");
          fill.style.width = progress * 100 + "%";

          // Optional: hide loader when finished
          if (progress >= 1) {
            document.getElementById("custom-loader").style.display = "none";
          }
        }
      );
    </script>
  </body>
</html>
